"use strict";(self.webpackChunkangular=self.webpackChunkangular||[]).push([[900],{4900:(ct,N,d)=>{d.r(N),d.d(N,{ProspectionsModule:()=>lt});var C=d(177),a=d(1747),i=d(9640),g=d(513),ae=d(2047),S=d(3390),f=d(4041),F=d(8141),de=d(5558),m=d(6354),v=d(1397),k=d(9437),_=d(7673);const I=(0,i.VP)("[Prospections] Load Prospections"),U=(0,i.VP)("[Prospections] Load Prospections Success",(0,i.xk)()),X=((0,i.VP)("[Prospections] Load Prospections Failure",(0,i.xk)()),(0,i.VP)("[Prospection] Create Prospection",(0,i.xk)())),L=(0,i.VP)("[Prospection] Create Prospection Success",(0,i.xk)()),B=((0,i.VP)("[Prospection] Create Prospection Failure",(0,i.xk)()),(0,i.VP)("[Prospection] Remove Prospection",(0,i.xk)())),Y=(0,i.VP)("[Prospection] Remove Prospection Success",(0,i.xk)()),ue=(0,i.VP)("[Prospection] Remove Prospection Failure",(0,i.xk)()),P=(0,i.VP)("[Prospection] Update Prospection",(0,i.xk)()),T=(0,i.VP)("[Prospection] Update Prospection Success",(0,i.xk)()),A=(0,i.VP)("[Prospection] Update Prospection Failure",(0,i.xk)()),H=(0,i.VP)("[Prospection] Set Prospection Filters",(0,i.xk)());var e=d(4438),w=d(5312),D=d(1626);let me=(()=>{class o{constructor(t){this.http=t,this.apiUrl=`${w.c.apiURL}/prospections`}getAll(){return this.http.get(`${this.apiUrl}`)}getById(t){return this.http.get(`${this.apiUrl}/${t}`)}create(t){return this.http.post(`${this.apiUrl}`,t)}update(t,r){return this.http.patch(`${this.apiUrl}/${t}`,r)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(D.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),he=(()=>{class o{constructor(t,r){this.actions$=t,this.prospectionsService=r,this.loadProspections$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(I),(0,F.M)(n=>console.log("loadProspections",n)),(0,de.n)(()=>this.prospectionsService.getAll()),(0,F.M)(n=>console.log("prospections res",n)),(0,m.T)(n=>U({prospections:n})))),this.createProspection$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(X),(0,v.Z)(n=>this.prospectionsService.create(n.prospection).pipe((0,F.M)(console.log),(0,m.T)(l=>L({prospection:l})))))),this.removeProspection$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(B),(0,v.Z)(n=>this.prospectionsService.delete(n.id).pipe((0,m.T)(()=>Y({id:n.id})),(0,k.W)(l=>(0,_.of)(ue({error:l}))))))),this.updateProspection$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(P),(0,v.Z)(n=>this.prospectionsService.update(n.id,n.changes).pipe((0,m.T)(()=>T({id:n.id,changes:n.changes})),(0,k.W)(l=>(0,_.of)(A({error:l})))))))}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(a.En),e.KVO(me))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}}return o})();const ve=(0,i.vy)({prospections:[],filters:{status:[],city:[],sellers:[]}},(0,i.on)(U,(o,{prospections:s})=>({...o,prospections:s})),(0,i.on)(L,(o,{prospection:s})=>({...o,prospections:[...o.prospections,s]})),(0,i.on)(Y,(o,{id:s})=>({...o,prospections:o.prospections.filter(t=>t.id!==s)})),(0,i.on)(T,(o,{id:s,changes:t})=>({...o,prospections:o.prospections.map(r=>r.id===s?{...r,...t}:r)})),(0,i.on)(H,(o,{filters:s})=>({...o,filters:s})));var J=d(1188);const E=[{key:"Unresponsive",label:"Sans r\xe9ponse",shortLabel:"attente",color:"var(--rentx-prospection-color-unresponsive)",colorLight:"var(--rentx-prospection-color-unresponsive-active)",icon:"question-circle",iconTheme:"fill"},{key:"Contacted",label:"Contact\xe9",shortLabel:"contact",color:"var(--rentx-prospection-color-contacted)",colorLight:"var(--rentx-prospection-color-contacted-active)",icon:"message",iconTheme:"fill"},{key:"Scheduled",label:"Visite planifi\xe9e",shortLabel:"visite",color:"var(--rentx-prospection-color-scheduled)",colorLight:"var(--rentx-prospection-color-scheduled-active)",icon:"calendar",iconTheme:"fill"},{key:"Visited",label:"Visite effectu\xe9e",shortLabel:"visite",color:"var(--rentx-prospection-color-visited)",colorLight:"var(--rentx-prospection-color-visited-active)",icon:"eye",iconTheme:"fill"},{key:"Abandoned",label:"Bien abandonn\xe9",shortLabel:"abandonn\xe9",color:"var(--rentx-prospection-color-abandoned)",colorLight:"var(--rentx-prospection-color-abandoned-active)",icon:"stop",iconTheme:"fill"},{key:"Pending",label:"Offre envoy\xe9e",shortLabel:"envoy\xe9",color:"var(--rentx-prospection-color-pending)",colorLight:"var(--rentx-prospection-color-pending-active)",icon:"hourglass",iconTheme:"fill"},{key:"Declined",label:"Offre refus\xe9e",shortLabel:"refus\xe9e",color:"var(--rentx-prospection-color-declined)",colorLight:"var(--rentx-prospection-color-declined-active)",icon:"close-circle",iconTheme:"fill"},{key:"Countered",label:"Contre proposition",shortLabel:"contr\xe9",color:"var(--rentx-prospection-color-countered)",colorLight:"var(--rentx-prospection-color-countered-active)",icon:"swap-left",iconTheme:"outline"},{key:"Accepted",label:"Offre accept\xe9e",shortLabel:"accept\xe9",color:"var(--rentx-prospection-color-accepted)",colorLight:"var(--rentx-prospection-color-accepted-active)",icon:"check-circle",iconTheme:"fill"},{key:"Validated",label:"Date de compromis de vente valid\xe9e",shortLabel:"compromis",color:"var(--rentx-prospection-color-validated)",colorLight:"var(--rentx-prospection-color-validated-active)",icon:"calendar",iconTheme:"fill"},{key:"Signed",label:"Compromis de vente sign\xe9",shortLabel:"compromis",color:"var(--rentx-prospection-color-signed)",colorLight:"var(--rentx-prospection-color-signed-active)",icon:"file-done",iconTheme:"outline"},{key:"Completed",label:"Acquisition termin\xe9e",shortLabel:"acquis",color:"var(--rentx-prospection-color-completed)",colorLight:"var(--rentx-prospection-color-completed-active)",icon:"trophy",iconTheme:"fill"},{key:"UnderContract",label:"Bien sous compromis de vente",shortLabel:"perdu",color:"var(--rentx-prospection-color-undercontract",colorLight:"var(--rentx-prospection-color-undercontract-active)",icon:"form",iconTheme:"outline"},{key:"Sold",label:"Bien vendu",shortLabel:"perdu",color:"var(--rentx-prospection-color-sold)",colorLight:"var(--rentx-prospection-color-sold-active)",icon:"lock",iconTheme:"fill"}],K=(0,i.UX)("offers"),ke=((0,i.Mz)(K,o=>o.offers.map(s=>({...s}))),(0,i.UX)("sellers")),V=(0,i.Mz)(ke,o=>o.sellers.map(s=>({...s,displayName:_e(s)}))),_e=o=>{let s=o.name;return(!s||""===s)&&(s=o.agency),(!s||""===s)&&(s="inconnu"),s},Z=(0,i.UX)("prospections"),Q=((0,i.UX)("sellers"),(0,i.Mz)(Z,o=>o.prospections)),ge=(0,i.Mz)(Z,o=>o.filters),Se=(0,i.Mz)(Q,ge,V,K,(o,s,t,r)=>Ce(o,s,t,r.offers)),Fe=(0,i.Mz)(Q,o=>o.map(s=>s.city).filter((s,t,r)=>r.indexOf(s)===t)),Ce=(o,s,t,r)=>ye(o,s).map(l=>{const c=t?.find(h=>h.id===l.seller_id);return{...l,seller:c||null,offer:r.find(h=>h.prospection_id===l.id),statusObject:l.status?{...E.find(h=>h.key===l.status)}:null}}),ye=(o,s)=>o.filter(t=>!(Pe(t,s.status)||ze(t,s.city)||be(t,s.sellers))),Pe=(o,s)=>s.length>0&&o.status&&!s.includes(o.status),ze=(o,s)=>s.length>0&&!s.includes(o.city??""),be=(o,s)=>s.length>0&&!s.includes(o.seller_id??"");var p=d(4341),z=d(1997),b=d(6389),G=d(5930);let je=(()=>{class o{constructor(t,r,n){this.fb=t,this.modal=r,this.store=n,this.form=this.fb.group({city:["",p.k0.required],zip:[""],address:[""],link:[""],price:[null]})}create(){this.form.valid&&(this.store.dispatch(X({prospection:this.form.value})),this.modal.close())}close(){this.modal.close()}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(p.ok),e.rXU(S.J9),e.rXU(i.il))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-create-prospection"]],standalone:!0,features:[e.aNF],decls:22,vars:1,consts:[[1,"form-group-popup",3,"formGroup"],["for","city"],["id","city","formControlName","city"],["for","zip"],["id","zip","formControlName","zip"],["for","address"],["id","address","formControlName","address"],["for","link"],["id","link","formControlName","link"],["for","price"],["id","price","type","number","formControlName","price"],["for","resume"],["id","resume","type","text","formControlName","resume"],[1,"footer"],["nz-button","","nzType","primary","type","submit",3,"click"]],template:function(r,n){1&r&&(e.j41(0,"form",0)(1,"label",1),e.EFF(2,"Ville:"),e.k0s(),e.nrm(3,"input",2),e.j41(4,"label",3),e.EFF(5,"Code Postal:"),e.k0s(),e.nrm(6,"input",4),e.j41(7,"label",5),e.EFF(8,"Addresse:"),e.k0s(),e.nrm(9,"input",6),e.j41(10,"label",7),e.EFF(11,"Link:"),e.k0s(),e.nrm(12,"input",8),e.j41(13,"label",9),e.EFF(14,"Price:"),e.k0s(),e.nrm(15,"input",10),e.j41(16,"label",11),e.EFF(17,"Description:"),e.k0s(),e.nrm(18,"textarea",12),e.k0s(),e.j41(19,"div",13)(20,"button",14),e.bIt("click",function(){return n.create()}),e.EFF(21,"Create"),e.k0s()()),2&r&&e.Y8G("formGroup",n.form)},dependencies:[p.X1,p.qT,p.me,p.Q0,p.BC,p.cb,p.j4,p.JD,z.DH,g.Zw,g.aO,b.c,G.p],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}div[_ngcontent-%COMP%]{margin-bottom:10px}label[_ngcontent-%COMP%]{margin-right:10px}button[_ngcontent-%COMP%]{margin-top:10px}"]})}}return o})(),xe=(()=>{class o{constructor(){}static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var O=d(9079);const W=(0,i.VP)("[Seller] Load Sellers"),q=(0,i.VP)("[Seller] Load Sellers Success",(0,i.xk)()),$e=(0,i.VP)("[Seller] Load Sellers Failure",(0,i.xk)()),ee=(0,i.VP)("[Seller] Create Seller",(0,i.xk)()),j=(0,i.VP)("[Seller] Create Seller Success",(0,i.xk)()),te=(0,i.VP)("[Seller] Create Seller Failure",(0,i.xk)()),oe=(0,i.VP)("[Seller] Update Seller",(0,i.xk)()),M=(0,i.VP)("[Seller] Update Seller Success",(0,i.xk)()),Te=(0,i.VP)("[Seller] Update Seller Failure",(0,i.xk)()),ne=(0,i.VP)("[Seller] Remove Seller",(0,i.xk)()),re=(0,i.VP)("[Seller] Remove Seller Success",(0,i.xk)()),we=(0,i.VP)("[Seller] Remove Seller Failure",(0,i.xk)());let x=(()=>{class o extends xe{constructor(t,r){super(),this.store=t,this.actions$=r}createSeller(t){return this.store.dispatch(ee({seller:t})),(0,O.ot)(this.actions$.pipe((0,a.gp)(j),(0,m.T)(r=>r.seller)))}removeSeller(t){this.store.dispatch(ne({id:t.id}))}getSellers(){return this.store.selectSignal(V)}updateSeller(t){return this.store.dispatch(oe({seller:t})),this.actions$.pipe((0,a.gp)(M),(0,m.T)(r=>r.seller))}setSeller(t,r){this.store.dispatch(P({id:t.id,changes:{seller_id:r.id}}))}setSellerSuccess(){return(0,O.ot)(this.actions$.pipe((0,a.gp)(T),(0,k.W)(()=>(0,_.of)(!1)),(0,m.T)(()=>!0)))}setSellerFailure(){return(0,O.ot)(this.actions$.pipe((0,a.gp)(A),(0,m.T)(()=>!0)))}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(i.il),e.KVO(a.En))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),ie=(()=>{class o{constructor(t,r,n){this.fb=t,this.modal=r,this.prospectionFacade=n,this.form=this.fb.group({name:["",p.k0.required],email:["",[p.k0.email]],phone:[""],address:[""],zip:[""],city:[""],agency:[""]})}create(){this.form.valid&&(this.prospectionFacade.createSeller(this.form.value),this.modal.close())}close(){this.modal.close()}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(p.ok),e.rXU(S.J9),e.rXU(x))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-create-seller-popup"]],standalone:!0,features:[e.aNF],decls:25,vars:2,consts:[[1,"form-group-popup",3,"formGroup"],["for","name"],["id","name","formControlName","name"],["for","email"],["id","email","formControlName","email"],["for","phone"],["id","phone","formControlName","phone"],["for","agency"],["id","agency","formControlName","agency"],["for","address"],["id","address","formControlName","address"],["id","address","formControlName","zip"],["id","address","formControlName","city"],[1,"footer"],["nz-button","","nzType","primary","type","submit",3,"click","disabled"]],template:function(r,n){1&r&&(e.j41(0,"form",0)(1,"label",1),e.EFF(2,"Name:"),e.k0s(),e.nrm(3,"input",2),e.j41(4,"label",3),e.EFF(5,"Email:"),e.k0s(),e.nrm(6,"input",4),e.j41(7,"label",5),e.EFF(8,"Phone:"),e.k0s(),e.nrm(9,"input",6),e.j41(10,"label",7),e.EFF(11,"Agence:"),e.k0s(),e.nrm(12,"input",8),e.j41(13,"label",9),e.EFF(14,"Adresse:"),e.k0s(),e.nrm(15,"input",10),e.j41(16,"label",9),e.EFF(17,"Code Postal:"),e.k0s(),e.nrm(18,"input",11),e.j41(19,"label",9),e.EFF(20,"Ville:"),e.k0s(),e.nrm(21,"input",12),e.k0s(),e.j41(22,"div",13)(23,"button",14),e.bIt("click",function(){return n.create()}),e.EFF(24,"Create"),e.k0s()()),2&r&&(e.Y8G("formGroup",n.form),e.R7$(23),e.Y8G("disabled",n.form.invalid))},dependencies:[p.X1,p.qT,p.me,p.BC,p.cb,p.j4,p.JD,z.DH,g.Zw,g.aO,b.c,G.p],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}div[_ngcontent-%COMP%]{margin-bottom:10px}label[_ngcontent-%COMP%]{margin-right:10px}button[_ngcontent-%COMP%]{margin-top:10px}"]})}}return o})();const De=[{sort:!0,title:"ville",compare:(o,s)=>o.city?.localeCompare(s.city??""),priority:1},{sort:!0,title:"CP",compare:(o,s)=>o.zip?.localeCompare(s.zip??""),priority:2},{sort:!0,title:"adresse",compare:(o,s)=>o.address?.localeCompare(s.address??""),priority:3},{sort:!0,title:"lien",compare:(o,s)=>o.link?.localeCompare(s.link??""),priority:4},{sort:!0,title:"vendeur",compare:(o,s)=>o.seller?.name?.localeCompare(s.seller?.name??""),priority:5},{sort:!0,title:"prix",compare:(o,s)=>(o.price??0)-(s.price??0),priority:6},{title:"parution",compare:(o,s)=>0,priority:7},{title:"offre",compare:(o,s)=>0,priority:8},{sort:!0,title:"status",compare:(o,s)=>o.status?.localeCompare(s.status??""),priority:1},{title:"actions",compare:(o,s)=>0,priority:10}];var R=d(4191),$=d(1868),y=d(2602),se=d(5154),Ee=d(1413),Ve=d(6977);let Ge=(()=>{class o{constructor(t,r,n){this.data=t,this.modal=r,this.prospectionFacade=n,this.seller=this.data.seller,this.formGroup=new p.gE({displayName:new p.MJ(this.seller.displayName),agency:new p.MJ(this.seller.agency),address:new p.MJ(this.seller.address),zip:new p.MJ(this.seller.zip),city:new p.MJ(this.seller.city),email:new p.MJ(this.seller.email),phone:new p.MJ(this.seller.phone)}),this.destroyComponent$=new Ee.B}ngOnInit(){this.formGroup.valueChanges.pipe((0,Ve.Q)(this.destroyComponent$),(0,F.M)(t=>{const r={...this.seller,...t,name:t.displayName};this.prospectionFacade.updateSeller(r)})).subscribe()}close(){this.modal.close()}ngOnDestroy(){this.destroyComponent$.next(),this.destroyComponent$.complete()}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(S.or),e.rXU(S.J9),e.rXU(x))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["show-seller-contact-popup"]],standalone:!0,features:[e.Jv_([x]),e.aNF],decls:29,vars:1,consts:[[1,"form-group-popup",3,"formGroup"],[1,"row"],["for","name"],["type","text","formControlName","displayName",1,"form-control"],["type","text","formControlName","agency",1,"form-control"],["type","text","formControlName","address",1,"form-control"],["type","text","formControlName","zip",1,"form-control"],["type","text","formControlName","city",1,"form-control"],["type","text","formControlName","email",1,"form-control"],["type","text","formControlName","phone",1,"form-control"]],template:function(r,n){1&r&&(e.j41(0,"form",0)(1,"div",1)(2,"div",2),e.EFF(3,"Nom"),e.k0s(),e.nrm(4,"input",3),e.k0s(),e.j41(5,"div",1)(6,"div",2),e.EFF(7,"Agence"),e.k0s(),e.nrm(8,"input",4),e.k0s(),e.j41(9,"div",1)(10,"div",2),e.EFF(11,"Adresse"),e.k0s(),e.nrm(12,"input",5),e.k0s(),e.j41(13,"div",1)(14,"div",2),e.EFF(15,"Code Postal"),e.k0s(),e.nrm(16,"input",6),e.k0s(),e.j41(17,"div",1)(18,"div",2),e.EFF(19,"Ville"),e.k0s(),e.nrm(20,"input",7),e.k0s(),e.j41(21,"div",1)(22,"div",2),e.EFF(23,"Email"),e.k0s(),e.nrm(24,"input",8),e.k0s(),e.j41(25,"div",1)(26,"div",2),e.EFF(27,"T\xe9l\xe9phone"),e.k0s(),e.nrm(28,"input",9),e.k0s()()),2&r&&e.Y8G("formGroup",n.formGroup)},dependencies:[p.X1,p.qT,p.me,p.BC,p.cb,p.j4,p.JD,z.DH,g.Zw],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-bottom:10px}.row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child{font-weight:700;width:150px}"]})}}return o})();function Oe(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",6),e.EFF(1),e.k0s(),e.j41(2,"nz-dropdown-menu",null,1)(4,"ul",4)(5,"li",7),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.showContact())}),e.EFF(6,"voir contact"),e.k0s(),e.j41(7,"li",8),e.EFF(8,"changer le vendeur"),e.k0s()()()}if(2&o){let t;const r=e.sdS(3),n=e.XpG(),l=e.sdS(4);e.Y8G("nzDropdownMenu",r)("nzTrigger","click")("nzOverlayClassName","customContainer"),e.R7$(),e.JRh(null==(t=n.prospection().seller)?null:t.displayName),e.R7$(6),e.Y8G("nzDropdownMenu",l)}}function Me(o,s){if(1&o&&(e.j41(0,"div",2),e.EFF(1,"+"),e.k0s()),2&o){e.XpG();const t=e.sdS(4);e.Y8G("nzTrigger","click")("nzDropdownMenu",t)}}function Re(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",9),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.create())}),e.EFF(1,"+"),e.k0s()}}function Ne(o,s){if(1&o){const t=e.RV6();e.j41(0,"li",10),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.XpG();return e.Njj(l.setSeller(n))}),e.j41(1,"div",11)(2,"div"),e.EFF(3),e.k0s(),e.j41(4,"div",12),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.XpG();return e.Njj(l.removeSeller(n))}),e.k0s()()()}if(2&o){const t=s.$implicit;e.R7$(3),e.JRh(t.displayName)}}let Ie=(()=>{class o{constructor(t,r){this.prospectionFacade=t,this.nzModalService=r,this.prospection=e.hFB.required(),this.sellers=this.prospectionFacade.getSellers()}setSeller(t){this.prospectionFacade.setSeller(this.prospection(),t)}create(){this.nzModalService.create({nzTitle:"Create Seller",nzContent:ie,nzFooter:null})}showContact(){this.nzModalService.create({nzTitle:"Contact",nzContent:Ge,nzFooter:null,nzData:{seller:this.prospection().seller}})}removeSeller(t){this.prospectionFacade.removeSeller(t)}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(x),e.rXU(S.N_))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["sellers-cell"]],inputs:{prospection:[1,"prospection"]},decls:8,vars:1,consts:[["sellersDropDown","nzDropdownMenu"],["menuSellerDropdown","nzDropdownMenu"],["nz-dropdown","",1,"empty-field","clickable",3,"nzTrigger","nzDropdownMenu"],[1,"empty-field","create","clickable"],["nz-menu","","nzSelectable","",1,"sellers"],["nz-menu-item",""],["nz-dropdown","",1,"seller-name","clickable",3,"nzDropdownMenu","nzTrigger","nzOverlayClassName"],["nz-menu-item","",1,"clickable",3,"click"],["nz-menu-item","","nz-dropdown","",1,"clickable",3,"nzDropdownMenu"],[1,"empty-field","create","clickable",3,"click"],["nz-menu-item","",3,"click"],[1,"seller-item"],["nz-icon","","nzType","delete",1,"delete",3,"click"]],template:function(r,n){1&r&&(e.DNE(0,Oe,9,5)(1,Me,2,2,"div",2)(2,Re,2,0,"div",3),e.j41(3,"nz-dropdown-menu",null,0)(5,"ul",4),e.Z7z(6,Ne,5,1,"li",5,e.fX1),e.k0s()()),2&r&&(e.vxM(n.prospection().seller?0:n.sellers().length?1:2),e.R7$(6),e.Dyx(n.sellers()))},dependencies:[b.c,R.Dn,$.jS,$.CU,y.j3,y.wQ],styles:["[_nghost-%COMP%]{min-width:100px!important;width:100px!important;display:flex}.seller-name[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;max-width:100px;display:inline-block}.empty-field[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:center;align-items:center;gap:10px;width:100%;height:100%;padding:0 10px;border-radius:5px}.sellers[_ngcontent-%COMP%]{min-width:100px!important}.seller-item[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;align-items:center;gap:10px;width:100%;min-width:100px;border-radius:5px}"]})}}return o})();const le=o=>({"background-color":o});function Ue(o,s){if(1&o){const t=e.RV6();e.j41(0,"td",20),e.bIt("click",function(){e.eBV(t);const n=e.sdS(4),l=e.XpG().$implicit,c=e.XpG();return e.Njj(c.startEdit(l.id+"link",n))}),e.j41(1,"div",21),e.EFF(2),e.k0s(),e.j41(3,"input",22,7),e.bIt("blur",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.editLink=!1)})("blur",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.stopEdit())})("change",function(){e.eBV(t);const n=e.sdS(4),l=e.XpG().$implicit,c=e.XpG();return e.Njj(c.edit(l,"link",n))}),e.k0s()()}if(2&o){const t=e.XpG().$implicit,r=e.XpG();e.R7$(),e.Y8G("hidden",r.editId===t.id+"link"),e.R7$(),e.JRh(t.link),e.R7$(),e.Y8G("value",t.link)("hidden",r.editId!==t.id+"link")}}function Xe(o,s){if(1&o){const t=e.RV6();e.j41(0,"td")(1,"div",37)(2,"a",38),e.EFF(3,"lien vers l'annonce"),e.k0s()(),e.j41(4,"nz-dropdown-menu",39,8)(6,"ul",40)(7,"li",33),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.editLink=!0)}),e.EFF(8,"editer"),e.k0s()()()()}if(2&o){const t=e.sdS(5),r=e.XpG().$implicit;e.R7$(),e.Y8G("nzDropdownMenu",t),e.R7$(),e.Y8G("href",r.link,e.B4B)}}function Le(o,s){if(1&o&&(e.j41(0,"div",41)(1,"span",42),e.EFF(2),e.k0s(),e.nrm(3,"div",43),e.k0s()),2&o){const t=e.XpG().$implicit,r=e.sdS(45);e.Aen(e.eq3(8,le,null==t.statusObject?null:t.statusObject.color)),e.Y8G("nzDropdownMenu",r)("nzTrigger","click"),e.R7$(),e.Y8G("nzTooltipTitle",null==t.statusObject?null:t.statusObject.label),e.R7$(),e.JRh(null==t.statusObject?null:t.statusObject.shortLabel),e.R7$(),e.Y8G("nzType",null==t.statusObject?null:t.statusObject.icon)("nzTheme",null==t.statusObject?null:t.statusObject.iconTheme)}}function Be(o,s){if(1&o&&(e.j41(0,"div",29),e.EFF(1," +"),e.k0s()),2&o){e.XpG();const t=e.sdS(45);e.Y8G("nzDropdownMenu",t)("nzTrigger","click")}}function Ye(o,s){if(1&o){const t=e.RV6();e.j41(0,"ul",36),e.nrm(1,"div",44),e.j41(2,"li",33),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.XpG().$implicit,c=e.XpG();return e.Njj(c.setStatus(l,n.key))}),e.EFF(3),e.k0s()()}if(2&o){const t=s.$implicit;e.R7$(),e.Aen(e.eq3(3,le,t.color)),e.R7$(2),e.JRh(t.label)}}function Ae(o,s){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"td",20),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.sdS(5),c=e.XpG();return e.Njj(c.startEdit(n.id+"city",l))}),e.j41(2,"div",21),e.EFF(3),e.k0s(),e.j41(4,"input",22,1),e.bIt("blur",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.stopEdit())})("change",function(){const n=e.eBV(t).$implicit,l=e.sdS(5),c=e.XpG();return e.Njj(c.edit(n,"city",l))}),e.k0s()(),e.j41(6,"td",23),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.sdS(10),c=e.XpG();return e.Njj(c.startEdit(n.id+"zip",l))}),e.j41(7,"div",21),e.EFF(8),e.k0s(),e.j41(9,"input",22,2),e.bIt("blur",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.stopEdit())})("change",function(){const n=e.eBV(t).$implicit,l=e.sdS(10),c=e.XpG();return e.Njj(c.edit(n,"zip",l))}),e.k0s()(),e.j41(11,"td",20),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.sdS(15),c=e.XpG();return e.Njj(c.startEdit(n.id+"address",l))}),e.j41(12,"div",21),e.EFF(13),e.k0s(),e.j41(14,"input",22,3),e.bIt("blur",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.stopEdit())})("change",function(){const n=e.eBV(t).$implicit,l=e.sdS(15),c=e.XpG();return e.Njj(c.edit(n,"address",l))}),e.k0s()(),e.DNE(16,Ue,5,4,"td",24)(17,Xe,9,2,"td"),e.j41(18,"td"),e.nrm(19,"sellers-cell",25),e.k0s(),e.j41(20,"td",26),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.sdS(24),c=e.XpG();return e.Njj(c.startEdit(n.id+"price",l))}),e.j41(21,"div",21),e.EFF(22),e.k0s(),e.j41(23,"input",27,4),e.bIt("blur",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.stopEdit())})("change",function(){const n=e.eBV(t).$implicit,l=e.sdS(24),c=e.XpG();return e.Njj(c.edit(n,"price",l))}),e.k0s()(),e.j41(25,"td"),e.EFF(26),e.nI1(27,"date"),e.k0s(),e.j41(28,"td"),e.EFF(29),e.k0s(),e.j41(30,"td"),e.DNE(31,Le,4,10,"div",28)(32,Be,2,2,"div",29),e.k0s(),e.j41(33,"td")(34,"div",30),e.nrm(35,"div",31),e.j41(36,"nz-dropdown-menu",null,5)(38,"ul",32)(39,"li",33),e.bIt("click",function(){const n=e.eBV(t).$implicit,l=e.XpG();return e.Njj(l.remove(n))}),e.j41(40,"div",34)(41,"div"),e.EFF(42,"Supprimer"),e.k0s(),e.nrm(43,"i",35),e.k0s()()()()()(),e.j41(44,"nz-dropdown-menu",null,6),e.Z7z(46,Ye,4,5,"ul",36,e.fX1),e.k0s()()}if(2&o){const t=s.$implicit,r=e.sdS(37),n=e.XpG();e.R7$(2),e.Y8G("hidden",n.editId===t.id+"city"),e.R7$(),e.JRh(t.city),e.R7$(),e.Y8G("value",t.city)("hidden",n.editId!==t.id+"city"),e.R7$(3),e.Y8G("hidden",n.editId===t.id+"zip"),e.R7$(),e.JRh(t.zip),e.R7$(),e.Y8G("value",t.zip)("hidden",n.editId!==t.id+"zip"),e.R7$(3),e.Y8G("hidden",n.editId===t.id+"address"),e.R7$(),e.JRh(t.address),e.R7$(),e.Y8G("value",t.address)("hidden",n.editId!==t.id+"address"),e.R7$(2),e.vxM(n.editLink?16:17),e.R7$(3),e.Y8G("prospection",t),e.R7$(2),e.Y8G("hidden",n.editId===t.id+"price"),e.R7$(),e.JRh(t.price),e.R7$(),e.Y8G("value",t.price)("hidden",n.editId!==t.id+"price"),e.R7$(3),e.JRh(e.i5U(27,24,t.emission_date,"dd/MM/YYYY")),e.R7$(3),e.SpI(" ",null==t||null==t.offer?null:t.offer.price," "),e.R7$(2),e.vxM(t.status?31:32),e.R7$(4),e.Y8G("nzDropdownMenu",r)("nzTrigger","click"),e.R7$(3),e.Y8G("id","prospection_actions_dropdown_"+t.id),e.R7$(8),e.Dyx(n.prospectionStatuses)}}const He=[{path:"",component:(()=>{class o{constructor(t,r){this.store=t,this.modalService=r,this.pageSize=8,this.prospections=this.store.selectSignal(Se),this.prospectionStatuses=E,this.prospectionStatusesFilters=E.map(n=>({text:n.shortLabel,value:n.key})),this.prospectionCityFilters=(0,e.EWP)(()=>this.store.selectSignal(Fe)().filter(Boolean).map(l=>({text:l,value:l}))),this.allSellersFilters=(0,e.EWP)(()=>this.store.selectSignal(V)().map(n=>({text:n.displayName,value:n.id}))),this.columns=De,this.hoveredRow=null,this.editLink=!1,this.store.dispatch(I())}ngOnInit(){this.calculatePageSize()}calculatePageSize(){const t=window.innerHeight-250;this.pageSize=Math.floor(t/64)}onQueryParamsChange(t){const r=t?.filter,n=r?.find(h=>"status"===h.key),l=r?.find(h=>"city"===h.key),c=r?.find(h=>"seller"===h.key);console.log("sellers",c),(n||l||c)&&this.store.dispatch(H({filters:{status:n?.value,city:l?.value,sellers:c?.value}}))}openCreatePropspectionPopup(){this.modalService.create({nzTitle:"Create Prospection",nzContent:je,nzFooter:null})}openCreateSellerPopup(){this.modalService.create({nzTitle:"Create Seller",nzContent:ie,nzFooter:null})}remove(t){null!=t.id&&this.store.dispatch(B({id:t.id}))}setStatus(t,r){null!=t.id&&this.store.dispatch(P({id:t.id,changes:{status:r}}))}startEdit(t,r){this.editId=t,setTimeout(()=>{requestAnimationFrame(()=>{r.focus()})},0)}edit(t,r,n){if(null==t.id)return;const l={id:t.id};l[r]=n.value,this.store.dispatch(P({id:t.id,changes:l}))}stopEdit(){this.editId=null}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(i.il),e.rXU(S.N_))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-prospections"]],decls:34,vars:23,consts:[["tables",""],["editableCityInput",""],["editableZipInput",""],["editableAddressInput",""],["editablePriceInput",""],["actionsDropdown",""],["prospectionStatus",""],["editableLinkInput",""],["linkDropdown",""],[1,"table-component"],[1,"container"],[1,"header"],["nz-button","","nzType","default",3,"click"],[1,"table-container"],[3,"nzQueryParams","nzData","nzPageSize"],["nzColumnKey","city",3,"nzSortFn","nzSortPriority","nzFilters","nzFilterFn"],[3,"nzSortFn","nzSortPriority"],["nzColumnKey","seller",3,"nzSortFn","nzSortPriority","nzFilters","nzFilterFn"],["nzColumnKey","status",3,"nzSortFn","nzSortPriority","nzFilters","nzFilterFn"],[4,"ngFor","ngForOf"],[1,"editable-cell-number","clickable","field-medium",3,"click"],[3,"hidden"],["nz-demo-input-text-basic","","type","text",3,"blur","change","value","hidden"],[1,"editable-cell-number","clickable","field-small",3,"click"],[1,"editable-cell-number","clickable","field-medium"],[3,"prospection"],[1,"editable-cell-number","clickable",3,"click"],["nz-demo-input-text-basic","","type","number",3,"blur","change","value","hidden"],["nz-dropdown","",1,"status","clickable",3,"nzDropdownMenu","nzTrigger","style"],["nz-dropdown","",1,"empty-field","clickable",3,"nzDropdownMenu","nzTrigger"],[1,"action"],["nz-dropdown","","nz-icon","","nzType","tool","nzTheme","fill",1,"tool",3,"nzDropdownMenu","nzTrigger"],["nz-menu","",3,"id"],["nz-menu-item","",3,"click"],[1,"dropdown-item"],["nz-icon","","nzType","delete","nzTheme","fill"],["nz-menu","",1,"status-item"],["nz-dropdown","",1,"clickable",3,"nzDropdownMenu"],["target","_blank",3,"href"],["nz-dropdown-menu",""],["nz-menu",""],["nz-dropdown","",1,"status","clickable",3,"nzDropdownMenu","nzTrigger"],["nz-tooltip","",3,"nzTooltipTitle"],["nz-icon","",3,"nzType","nzTheme"],[1,"color-indicator"]],template:function(r,n){if(1&r){const l=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),e.bIt("click",function(){return e.eBV(l),e.Njj(n.openCreatePropspectionPopup())}),e.EFF(4,"Ajouter un bien en prospection"),e.k0s(),e.j41(5,"button",12),e.bIt("click",function(){return e.eBV(l),e.Njj(n.openCreateSellerPopup())}),e.EFF(6,"Ajouter un vendeur / agent"),e.k0s()(),e.j41(7,"div",13)(8,"nz-table",14,0),e.bIt("nzQueryParams",function(h){return e.eBV(l),e.Njj(n.onQueryParamsChange(h))}),e.j41(10,"thead")(11,"tr")(12,"th",15),e.EFF(13,"ville"),e.k0s(),e.j41(14,"th",16),e.EFF(15,"CP"),e.k0s(),e.j41(16,"th",16),e.EFF(17,"adresse"),e.k0s(),e.j41(18,"th",16),e.EFF(19,"lien"),e.k0s(),e.j41(20,"th",17),e.EFF(21,"vendeur"),e.k0s(),e.j41(22,"th",16),e.EFF(23,"prix"),e.k0s(),e.j41(24,"th"),e.EFF(25,"parution"),e.k0s(),e.j41(26,"th"),e.EFF(27,"offre"),e.k0s(),e.j41(28,"th",18),e.EFF(29,"status"),e.k0s(),e.j41(30,"th"),e.EFF(31,"actions"),e.k0s()()(),e.j41(32,"tbody"),e.DNE(33,Ae,48,27,"tr",19),e.k0s()()()()()}if(2&r){const l=e.sdS(9);e.R7$(8),e.Y8G("nzData",n.prospections())("nzPageSize",n.pageSize),e.R7$(4),e.Y8G("nzSortFn",n.columns[0].compare)("nzSortPriority",n.columns[0].priority)("nzFilters",n.prospectionCityFilters())("nzFilterFn",!0),e.R7$(2),e.Y8G("nzSortFn",n.columns[1].compare)("nzSortPriority",n.columns[1].priority),e.R7$(2),e.Y8G("nzSortFn",n.columns[2].compare)("nzSortPriority",n.columns[2].priority),e.R7$(2),e.Y8G("nzSortFn",n.columns[3].compare)("nzSortPriority",n.columns[3].priority),e.R7$(2),e.Y8G("nzSortFn",n.columns[4].compare)("nzSortPriority",n.columns[4].priority)("nzFilters",n.allSellersFilters())("nzFilterFn",!0),e.R7$(2),e.Y8G("nzSortFn",n.columns[5].compare)("nzSortPriority",n.columns[5].priority),e.R7$(6),e.Y8G("nzSortFn",n.columns[8].compare)("nzSortPriority",n.columns[8].priority)("nzFilters",n.prospectionStatusesFilters)("nzFilterFn",!0),e.R7$(5),e.Y8G("ngForOf",l.data)}},dependencies:[C.Sq,g.aO,b.c,G.p,f.CP,f.Cc,f.SO,f._4,f.IL,f.aj,f.kt,R.Dn,$.jS,$.CU,y.j3,y.wQ,se.LH,Ie,C.vh],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column nowrap;align-items:center;justify-content:center;padding:20px}.container[_ngcontent-%COMP%]{width:100%}.tool[_ngcontent-%COMP%]{padding:2px;color:var(--ant-danger-color)}.dropdown-item[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;align-items:space-between;gap:10px;min-width:200px;width:100%}.color-indicator[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:6px;height:100%;border-radius:0 5px 5px 0}.status-item[_ngcontent-%COMP%]{padding-left:26px}.status[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:space-between;align-items:center;gap:10px;width:100%;height:100%;padding:0 10px;border-radius:5px;position:relative;color:#fff}.empty-field[_ngcontent-%COMP%]{display:flex;flex-flow:row nowrap;justify-content:center;align-items:center;gap:10px;width:100%;height:100%;padding:0 10px;border-radius:5px}"]})}}return o})()}];let Je=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[J.iI.forChild(He),J.iI]})}}return o})(),Ke=(()=>{class o{constructor(t){this.http=t,this.apiUrl=`${w.c.apiURL}/prospections/sellers`}getAll(){return this.http.get(`${this.apiUrl}/all`)}getById(t){return this.http.get(`${this.apiUrl}/${t}`)}create(t){return this.http.post(this.apiUrl,t)}update(t,r){return this.http.patch(`${this.apiUrl}/${t}`,r)}delete(t){return this.http.delete(`${this.apiUrl}/${t}`)}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(D.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Ze=d(7094);let Qe=(()=>{class o{constructor(t,r,n){this.actions$=t,this.sellerService=r,this.message=n,this.loadSellers$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(W),(0,v.Z)(()=>this.sellerService.getAll().pipe((0,m.T)(l=>q({sellers:l})),(0,k.W)(l=>(0,_.of)($e({error:l}))))))),this.addSeller$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(ee),(0,v.Z)(l=>this.sellerService.create(l.seller).pipe((0,m.T)(c=>j({seller:c})),(0,k.W)(c=>(0,_.of)(te({error:c}))))))),this.addSellerSuccess$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(j),(0,F.M)(()=>{this.message.success("Vendeur ajout\xe9 avec succ\xe8s!")})),{dispatch:!1}),this.addSellerFailure$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(te),(0,F.M)(()=>{this.message.error("Erreur lors de l'ajout de vendeur!")})),{dispatch:!1}),this.updateSeller$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(oe),(0,v.Z)(l=>this.sellerService.update(l.seller?.id,l.seller).pipe((0,m.T)(c=>M({seller:c})),(0,k.W)(c=>(0,_.of)(Te({error:c}))))))),this.removeSeller$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(ne),(0,v.Z)(l=>this.sellerService.delete(l.id).pipe((0,m.T)(()=>re({id:l.id})),(0,k.W)(c=>(0,_.of)(we({error:c})))))))}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(a.En),e.KVO(Ke),e.KVO(Ze.xh))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}}return o})();const qe=(0,i.vy)({sellers:[]},(0,i.on)(q,(o,{sellers:s})=>({...o,sellers:s})),(0,i.on)(j,(o,{seller:s})=>({...o,sellers:[...o.sellers,s]})),(0,i.on)(re,(o,{id:s})=>({...o,sellers:o.sellers.filter(t=>t.id!==s)})),(0,i.on)(M,(o,{seller:s})=>({...o,sellers:o.sellers.map(t=>t.id===s.id?s:t)})));let et=(()=>{class o{constructor(t){this.store=t,this.store.dispatch(W())}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(i.il))}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[C.MD,i.md.forFeature("sellers",qe),a.Vm.forFeature(Qe)]})}}return o})();const ce=(0,i.VP)("[Offers] Load Offers"),pe=(0,i.VP)("[Offers] Load Offers Success",(0,i.xk)()),tt=(0,i.VP)("[Offers] Load Offers Failure",(0,i.xk)());let ot=(()=>{class o{constructor(t){this.http=t}getAll(){return this.http.get(`${w.c.apiURL}/prospections/offers/get`)}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(D.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),nt=(()=>{class o{constructor(t,r){this.actions$=t,this.offersHttpService=r,this.loadOffers$=(0,a.EH)(()=>this.actions$.pipe((0,a.gp)(ce),(0,v.Z)(()=>this.offersHttpService.getAll().pipe((0,m.T)(n=>pe({offers:n})),(0,k.W)(n=>(0,_.of)(tt({error:n})))))))}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(a.En),e.KVO(ot))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac})}}return o})();const it=(0,i.vy)({offers:[]},(0,i.on)(pe,(o,{offers:s})=>({...o,offers:s})));let st=(()=>{class o{constructor(t){this.store=t,this.store.dispatch(ce())}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(i.il))}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[C.MD,i.md.forFeature("offers",it),a.Vm.forFeature(nt)]})}}return o})(),lt=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[C.MD,Je,i.md.forFeature("prospections",ve),a.Vm.forFeature(he),et,st,g.Zw,S.U6,f.$G,ae.GP,R.Y3,y.Cu,z.DH,se.Qt]})}}return o})()}}]);